<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><style type="text/css">body,html{width:100%;height:100%;margin:0;padding:0}body{background-color:#483b3a;overflow:hidden}.images{display:none}#controller{height:100%;left:0;top:0;position:absolute;width:100%}</style></head><body><canvas id="canvas"></canvas><div id="controller"></div><div class="images"><img id="chars" src="211b978092e108f73260bd7cafee076b.gif"> <img id="sword" src="c8b6dcc313e89174d1b37dc8b94e7d27.gif"> <img id="level" src="920e3171ac01bca391008ab5cd5db849.gif"> <img id="stats" src="264e737d2b10fc47d051bae6fa8cb421.gif"></div><script type="text/javascript">!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t){let e={container:document.body,width:50,height:50,left:0,top:50};this.options=Object.assign({},e,t),this.createElement()}createElement(){this.el=document.createElement("div");this.options.container.getBoundingClientRect();this.el.style.position="absolute",this.el.style.width=this.options.width+"vw",this.el.style.height=this.options.height+"vh",this.el.style.left=this.options.left+"vw",this.el.style.top=this.options.top+"vh",this.el.style.background="#999999AA"}show(){this.options.container.appendChild(this.el)}hide(){this.options.container.removeChild(this.el)}}class n{constructor(t){let e={"button-color":"#FF0000","track-color":"#00FF0099","button-size":12.5,"button-stroke-size":0,"track-size":15,"track-stroke-size":2,"track-stroke-color":"#FFFFFF","track-stroke-size":2,"tracking-element":document.body};this.options=Object.assign({},e,t),this._isAttached=!1,this.x=0,this.y=0,this.createCanvas()}createCanvas(){this.ratio=window.devicePixelRatio,this.canvas=document.createElement("canvas");const t=this.options["track-size"]+2*this.options["track-stroke-size"];this.canvas.width=t*this.ratio,this.canvas.height=t*this.ratio,this.canvas.style.width=t+"px",this.canvas.style.height=t+"px",this.context=this.canvas.getContext("2d")}start(t){this._isAttached&&(this.x=0,this.y=0,this.px=0,this.py=0)}getAngle(t,e){return 0==t?0:Math.atan(e/t)}getMultiplier(t){return t<0?-1:1}getAxisDelta(t){let e=this.getMultiplier(t);return t*e>.5?1*e:0}getAxis(){return{x:this.x,y:this.y,dx:this.getAxisDelta(this.x),dy:this.getAxisDelta(this.y)}}move(t,e){if(!this._isAttached)return;this.px=this.px+t,this.py=this.py+e;Math.sqrt(this.px*this.px+this.py*this.py);let i=this.getAngle(this.px,this.py),s=Math.abs(Math.cos(i)),n=Math.abs(Math.sin(i));1==s&&(n=1);let h=this.options["track-size"]/(2*this.ratio),r=Math.min(s,this.px/h),o=Math.min(n,this.py/h);this.x=Math.max(-s,r),this.y=Math.max(-n,o)}end(t){this.x=0,this.y=0}hide(){this._isAttached=!1,this.canvas.parentNode.removeChild(this.canvas)}show(){this._isAttached=!0,this.options["tracking-element"].appendChild(this.canvas)}setPosition(t,e){this.canvas.style.position="absolute";let i=this.options["track-size"]/(2*this.ratio);this.canvas.style.left=t-i+"px",this.canvas.style.top=e-i+"px"}draw(){if(!this._isAttached)return;this.context.clearRect(0,0,this.canvas.width,this.canvas.height);const t=this.options["track-size"]/2;this.drawCircle(t+this.options["track-stroke-size"],t+this.options["track-stroke-size"],t,this.options["track-color"],this.options["track-stroke-size"]*this.ratio,this.options["track-stroke-color"]);let e=(this.options["track-size"]-this.options["button-size"])/2;this.drawCircle(t+this.x*e+this.options["track-stroke-size"],t+this.y*e+this.options["track-stroke-size"],this.options["button-size"]/2,this.options["button-color"],this.options["button-stroke-size"]*this.ratio,this.options["button-stroke-color"])}drawCircle(t,e,i,s,n,h){this.context.beginPath(),this.context.arc(t,e,i,0,2*Math.PI,!1),this.context.fillStyle=s,this.context.lineWidth=n,this.context.strokeStyle=h,this.context.fill(),this.context.stroke()}}const h=class{constructor(t){let e={element:document.body,start:t=>{},move:t=>{},end:t=>{},width:100,height:100,left:0,top:0,sticks:[]};this.currentTouches=[],this.options=Object.assign({},e,t),this.startFn=t=>this.start(t),this.moveFn=t=>this.move(t),this.endFn=t=>this.end(t),this.bindEvents()}addStick(t){this.options.sticks.push(t)}removeStick(t){let e=this.options.sticks.indexOf(t);e>=-1&&this.options.sticks.splice(e,1)}bindEvents(){let t=this.options.element;t.addEventListener("touchstart",this.startFn,{passive:!1}),t.addEventListener("touchmove",this.moveFn,{passive:!1}),t.addEventListener("touchend",this.endFn,{passive:!1}),t.addEventListener("touchcancel",this.endFn,{passive:!1})}unbindEvents(){let t=this.options.element;t.removeEventListener("touchstart",this.startFn),t.removeEventListener("touchmove",this.moveFn),t.removeEventListener("touchend",this.endFn),t.removeEventListener("touchcancel",this.endFn)}inRange(t,e,i){let s=this.options.element.getBoundingClientRect(),n=s.width*(i.options.width/100),h=s.height*(i.options.height/100),r=s.width*(i.options.left/100),o=s.width*(i.options.top/100);return!(t<r||t>r+n)&&!(e<o||e>o+h)}findStick(t,e){let i=!1;return this.options.sticks.forEach(s=>{this.inRange(t,e,s)&&(i=s)}),i}start(t){for(let e=0;e<t.targetTouches.length;e++){let i=t.targetTouches[e];if(this.addTouchToStick(i))return t.preventDefault(),!1}}hasCurrentTouch(t){for(let e=0;e<this.currentTouches.length;e++){if(this.currentTouches[e].stick==t)return!0}return!1}addTouchToStick(t){let e=this.findStick(t.pageX,t.pageY);return!this.hasCurrentTouch(e)&&(!(!e||this.findTouch(this.currentTouches,t.identifier))&&(this.currentTouches.push({identifier:t.identifier,stick:e,x:t.pageX,y:t.pageY}),e.start(t),!0))}findTouch(t,e){for(let i=0;i<t.length;i++)if(t[i].identifier==e)return t[i];return!1}endOldTouches(t){for(let e=0;e<this.currentTouches.length;e++)this.findTouch(t,this.currentTouches[e].identifier)||(this.currentTouches[e].stick.end(),this.currentTouches.splice(e,1))}move(t){if(this.currentTouches.length)for(let e=0;e<t.changedTouches.length;e++){let i=t.changedTouches[e],s=this.findTouch(this.currentTouches,i.identifier);if(s){let e=i.pageX-s.x,n=i.pageY-s.y;return s.stick.move(e,n),s.x=i.pageX,s.y=i.pageY,t.preventDefault(),!1}}}end(t){if(this.currentTouches.length)return this.endOldTouches(t.targetTouches),t.preventDefault(),!1}};class r{constructor(t){const e={container:document.body,left:0,top:0,width:100,height:100,"track-size":180,"button-size":100,"button-color":"#FFFFFF99","button-stroke-color":"#FFFFFF","button-stroke-size":2,"track-color":"#00000099","track-stroke-color":"#FFFFFF","track-stroke-size":2,"touch-handler":null};this.options=Object.assign({},e,t),this.options["touch-handler"]||(this.options["touch-handler"]=new h({element:this.options.container})),this.container=new s,this.stick=new n({"tracking-element":this.options.container,"button-size":this.options["button-size"],"button-color":this.options["button-color"],"track-color":this.options["track-color"],"track-size":this.options["track-size"],"track-stroke-color":this.options["track-stroke-color"],"track-stroke-size":this.options["track-stroke-size"]}),this.options["touch-handler"].addStick(this)}start(t){this.stick.setPosition(t.pageX,t.pageY),this.stick.show(),this.stick.start()}move(t,e){this.stick.move(t,e)}end(){this.stick.hide(),this.stick.end()}draw(){this.stick.draw()}unbind(){this.options["touch-handler"].removeStick(this)}getAxis(){return this.stick.getAxis()}}e.TouchHandler=h,e.VirtualStick=r,e.default=r},function(t,e,i){},function(t,e,i){"use strict";i.r(e);let s,n,h={};function r(t,e){h[t]=h[t]||[],h[t].push(e)}function o(t,...e){h[t]&&h[t].map(t=>t(...e))}function a(){return s}function c(){return n}class l{constructor({spriteSheet:t,frames:e,frameRate:i,loop:s=!0}={}){this.spriteSheet=t,this.frames=e,this.frameRate=i,this.loop=s;let{width:n,height:h,margin:r=0}=t.frame;this.width=n,this.height=h,this.margin=r,this._f=0,this._a=0}clone(){return d(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:e,width:i=this.width,height:s=this.height,context:n=c()}={}){let h=this.frames[this._f]/this.spriteSheet._f|0,r=this.frames[this._f]%this.spriteSheet._f|0;n.drawImage(this.spriteSheet.image,r*this.width+(2*r+1)*this.margin,h*this.height+(2*h+1)*this.margin,this.width,this.height,t,e,i,s)}}function d(t){return new l(t)}d.prototype=l.prototype,d.class=l;let u=/(jpeg|jpg|gif|png)$/,p=/(wav|mp3|ogg|aac)$/,f=/^\//,g=/\/$/,m=new WeakMap,y="",w="",x="";function v(t,e){return new URL(t,e).href}function _(t,e){return[t.replace(g,""),t?e.replace(f,""):e].filter(t=>t).join("/")}function b(t){return t.split(".").pop()}function k(t){let e=t.replace("."+b(t),"");return 2==e.split("/").length?e.replace(f,""):e}function S(t){return{wav:"",mp3:t.canPlayType("audio/mpeg;"),ogg:t.canPlayType('audio/ogg; codecs="vorbis"'),aac:t.canPlayType("audio/aac;")}}let M={},A={},E={};function P(){window.__k||(window.__k={dm:m,u:v,d:E,i:M})}function j(t){return P(),new Promise((e,i)=>{let s,n,h;if(s=_(y,t),M[s])return e(M[s]);(n=new Image).onload=function(){h=v(s,window.location.href),M[k(t)]=M[s]=M[h]=this,e(this)},n.onerror=function(){i("Unable to load image "+s)},n.src=s})}function T(t){return new Promise((e,i)=>{let s,n,h,r;return s=new Audio,n=S(s),(t=[].concat(t).reduce((t,e)=>t||(n[b(e)]?e:null),0))?(h=_(w,t),A[h]?e(A[h]):(s.addEventListener("canplay",function(){r=v(h,window.location.href),A[k(t)]=A[h]=A[r]=this,e(this)}),s.onerror=function(){i("Unable to load audio "+h)},s.src=h,void s.load())):i("cannot play any of the audio formats provided"+t)})}function z(t){let e,i;return P(),e=_(x,t),E[e]?Promise.resolve(E[e]):fetch(e).then(t=>{if(!t.ok)throw t;return t.clone().json().catch(()=>t.text())}).then(s=>(i=v(e,window.location.href),"object"==typeof s&&m.set(s,i),E[k(t)]=E[e]=E[i]=s,s))}const F=()=>{};function O(){let t=a();c().clearRect(0,0,t.width,t.height)}let C={},L={},I={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};function W(t){let e=I[t.which];L[e]=!0,C[e]&&C[e](t)}function D(t){L[I[t.which]]=!1}function R(){L={}}function Y(t){let e=t.substr(t.search(/[A-Z]/));return e[0].toLowerCase()+e.substr(1)}function q(t,e){let i=t.indexOf(e);-1!==i&&t.splice(i,1)}let B=[],H=[],X={},$=[],N={},U={0:"left",1:"middle",2:"right"},K={x:0,y:0,radius:5};function G(t){let e=t.x,i=t.y;t.anchor&&(e-=t.width*t.anchor.x,i-=t.height*t.anchor.y);let s=K.x-Math.max(e,Math.min(K.x,e+t.width)),n=K.y-Math.max(i,Math.min(K.y,i+t.height));return s*s+n*n<K.radius*K.radius}function J(){let t,e,i=H.length?H:B;for(let s=i.length-1;s>=0;s--)if(e=(t=i[s]).collidesWithPointer?t.collidesWithPointer(K):G(t))return t}function V(t){let e=void 0!==t.button?U[t.button]:"left";N[e]=!0,et(t,"onDown")}function Q(t){let e=void 0!==t.button?U[t.button]:"left";N[e]=!1,et(t,"onUp")}function Z(t){et(t,"onOver")}function tt(){N={}}function et(t,e){let i,s,n=a();if(!n)return;-1!==["touchstart","touchmove","touchend"].indexOf(t.type)?(i=(t.touches[0]||t.changedTouches[0]).clientX,s=(t.touches[0]||t.changedTouches[0]).clientY):(i=t.clientX,s=t.clientY);let h=n.height/n.offsetHeight,r=n.getBoundingClientRect(),o=(i-r.left)*h,c=(s-r.top)*h;K.x=o,K.y=c,t.preventDefault();let l=J();l&&l[e]&&l[e](t),X[e]&&X[e](t,l)}class it{constructor({create:t,maxSize:e=1024}={}){let i;if(!t||!(i=t())||!(i.update&&i.init&&i.isAlive))throw Error("Must provide create() function which returns an object with init(), update(), and isAlive() functions");this._c=t,this._i=0,this.objects=[t()],this.size=1,this.maxSize=e}get(t={}){if(this.objects.length==this._i){if(this.size===this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.unshift(this._c());this.size=this.objects.length}let e=this.objects.shift();return e.init(t),this.objects.push(e),this._i++,e}getAliveObjects(){return this.objects.slice(this.objects.length-this._i)}clear(){this._i=this.objects.length=0,this.size=1,this.objects.push(this._c())}update(t){let e,i=this.size-1,s=Math.max(this.objects.length-this._i,0);for(;i>=s;)(e=this.objects[i]).update(t),e.isAlive()?i--:(this.objects=this.objects.splice(i,1).concat(this.objects),this._i--,s++)}render(){let t=Math.max(this.objects.length-this._i,0);for(let e=this.size-1;e>=t;e--)this.objects[e].render()}}function st(t){return new it(t)}function nt(t,e){let i=[],s=e.x+e.width/2,n=e.y+e.height/2,h=t.y<n&&t.y+t.height>=e.y,r=t.y+t.height>=n&&t.y<e.y+e.height;return t.x<s&&t.x+t.width>=e.x&&(h&&i.push(0),r&&i.push(2)),t.x+t.width>=s&&t.x<e.x+e.width&&(h&&i.push(1),r&&i.push(3)),i}st.prototype=it.prototype,st.class=it;class ht{constructor({maxDepth:t=3,maxObjects:e=25,bounds:i}={}){this.maxDepth=t,this.maxObjects=e;let s=a();this.bounds=i||{x:0,y:0,width:s.width,height:s.height},this._b=!1,this._d=0,this._o=[],this._s=[],this._p=null}clear(){this._s.map(function(t){t.clear()}),this._b=!1,this._o.length=0}get(t){let e,i,s=new Set;for(;this._s.length&&this._b;){for(e=nt(t,this.bounds),i=0;i<e.length;i++)this._s[e[i]].get(t).forEach(t=>s.add(t));return Array.from(s)}return this._o.filter(e=>e!==t)}add(){let t,e,i,s;for(e=0;e<arguments.length;e++)if(i=arguments[e],Array.isArray(i))this.add.apply(this,i);else if(this._b)this._a(i);else if(this._o.push(i),this._o.length>this.maxObjects&&this._d<this.maxDepth){for(this._sp(),t=0;s=this._o[t];t++)this._a(s);this._o.length=0}}_a(t,e,i){for(e=nt(t,this.bounds),i=0;i<e.length;i++)this._s[e[i]].add(t)}_sp(t,e,i){if(this._b=!0,!this._s.length)for(t=this.bounds.width/2|0,e=this.bounds.height/2|0,i=0;i<4;i++)this._s[i]=rt({bounds:{x:this.bounds.x+(i%2==1?t:0),y:this.bounds.y+(i>=2?e:0),width:t,height:e},maxDepth:this.maxDepth,maxObjects:this.maxObjects}),this._s[i]._d=this._d+1,this._s[i]._p=this}}function rt(t){return new ht(t)}rt.prototype=ht.prototype,rt.class=ht;class ot{constructor(t,e){this._x=t||0,this._y=e||0}add(t,e){return at(this.x+(t.x||0)*(e||1),this.y+(t.y||0)*(e||1))}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}function at(t,e){return new ot(t,e)}at.prototype=ot.prototype,at.class=ot;class ct{constructor(t){this.init(t)}init(t={}){let{x:e,y:i,dx:s,dy:n,ddx:h,ddy:r,width:o,height:a,image:l}=t;this.position=at(e,i),this.velocity=at(s,n),this.acceleration=at(h,r),this.width=this.height=this.rotation=0,this.ttl=1/0,this.anchor={x:0,y:0},this.context=c();for(let e in t)this[e]=t[e];l&&(this.width=void 0!==o?o:l.width,this.height=void 0!==a?a:l.height)}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}get animations(){return this._a}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}isAlive(){return this.ttl>0}collidesWith(t){if(this.rotation||t.rotation)return null;let e=this.x-this.width*this.anchor.x,i=this.y-this.height*this.anchor.y,s=t.x,n=t.y;return t.anchor&&(s-=t.width*t.anchor.x,n-=t.height*t.anchor.y),e<s+t.width&&e+this.width>s&&i<n+t.height&&i+this.height>n}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){this.velocity=this.velocity.add(this.acceleration,t),this.position=this.position.add(this.velocity,t),this.ttl--,this.currentAnimation&&this.currentAnimation.update(t)}draw(){let t=-this.width*this.anchor.x,e=-this.height*this.anchor.y;this.context.save(),this.context.translate(this.x,this.y),this.rotation&&this.context.rotate(this.rotation),this.image?this.context.drawImage(this.image,0,0,this.image.width,this.image.height,t,e,this.width,this.height):this.currentAnimation?this.currentAnimation.render({x:t,y:e,width:this.width,height:this.height,context:this.context}):(this.context.fillStyle=this.color,this.context.fillRect(t,e,this.width,this.height)),this.context.restore()}}function lt(t){return new ct(t)}function dt(t){if(+t===t)return t;let e=[],i=t.split(".."),s=+i[0],n=+i[1],h=s;if(s<n)for(;h<=n;h++)e.push(h);else for(;h>=n;h--)e.push(h);return e}lt.prototype=ct.prototype,lt.class=ct;class ut{constructor({image:t,frameWidth:e,frameHeight:i,frameMargin:s,animations:n}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:e,height:i,margin:s},this._f=t.width/e|0,this.createAnimations(n)}createAnimations(t){let e,i;for(i in t){let{frames:s,frameRate:n,loop:h}=t[i];if(e=[],void 0===s)throw Error("Animation "+i+" must provide a frames property");[].concat(s).map(t=>{e=e.concat(dt(t))}),this.animations[i]=d({spriteSheet:this,frames:e,frameRate:n,loop:h})}}}function pt(t){return new ut(t)}pt.prototype=ut.prototype,pt.class=ut;var ft={Animation:d,imageAssets:M,audioAssets:A,dataAssets:E,setImagePath:function(t){y=t},setAudioPath:function(t){w=t},setDataPath:function(t){x=t},loadImage:j,loadAudio:T,loadData:z,load:function(...t){return P(),Promise.all(t.map(t=>{let e=b([].concat(t)[0]);return e.match(u)?j(t):e.match(p)?T(t):z(t)}))},init:function(t){if(!(s=document.getElementById(t)||t||document.querySelector("canvas")))throw Error("You must provide a canvas element for the game");return(n=s.getContext("2d")).imageSmoothingEnabled=!1,o("init"),{canvas:s,context:n}},getCanvas:a,getContext:c,on:r,off:function(t,e){let i;!h[t]||(i=h[t].indexOf(e))<0||h[t].splice(i,1)},emit:o,GameLoop:function({fps:t=60,clearCanvas:e=!0,update:i,render:s}={}){if(!i||!s)throw Error("You must provide update() and render() functions");let n,h,r,a,c,l=0,d=1e3/t,u=1/t,p=e?O:F;function f(){if(h=requestAnimationFrame(f),r=performance.now(),a=r-n,n=r,!(a>1e3)){for(o("tick"),l+=a;l>=d;)c.update(u),l-=d;p(),c.render()}}return c={update:i,render:s,isStopped:!0,start(){n=performance.now(),this.isStopped=!1,requestAnimationFrame(f)},stop(){this.isStopped=!0,cancelAnimationFrame(h)},_frame:f,set _last(t){n=t}}},keyMap:I,initKeys:function(){let t;for(t=0;t<26;t++)I[65+t]=(10+t).toString(36);for(t=0;t<10;t++)I[48+t]=""+t;window.addEventListener("keydown",W),window.addEventListener("keyup",D),window.addEventListener("blur",R)},bindKeys:function(t,e){[].concat(t).map(t=>C[t]=e)},unbindKeys:function(t){[].concat(t).map(t=>C[t]=0)},keyPressed:function(t){return!!L[t]},registerPlugin:function(t,e){let i=t.prototype;i&&(i._inc||(i._inc={},i._bInc=function(t,e,...i){return this._inc[e].before.reduce((e,i)=>{let s=i(t,...e);return s||e},i)},i._aInc=function(t,e,i,...s){return this._inc[e].after.reduce((e,i)=>{let n=i(t,e,...s);return n||e},i)}),Object.getOwnPropertyNames(e).forEach(t=>{let s=Y(t);i[s]&&(i["_o"+s]||(i["_o"+s]=i[s],i[s]=function(...t){let e=this._bInc(this,s,...t),n=i["_o"+s].call(this,...e);return this._aInc(this,s,n,...t)}),i._inc[s]||(i._inc[s]={before:[],after:[]}),t.startsWith("before")?i._inc[s].before.push(e[t]):t.startsWith("after")&&i._inc[s].after.push(e[t]))}))},unregisterPlugin:function(t,e){let i=t.prototype;i&&i._inc&&Object.getOwnPropertyNames(e).forEach(t=>{let s=Y(t);t.startsWith("before")?q(i._inc[s].before,e[t]):t.startsWith("after")&&q(i._inc[s].after,e[t])})},extendObject:function(t,e){let i=t.prototype;i&&Object.getOwnPropertyNames(e).forEach(t=>{i[t]||(i[t]=e[t])})},initPointer:function(){let t=a();t.addEventListener("mousedown",V),t.addEventListener("touchstart",V),t.addEventListener("mouseup",Q),t.addEventListener("touchend",Q),t.addEventListener("blur",tt),t.addEventListener("mousemove",Z),t.addEventListener("touchmove",Z),r("tick",()=>{H.length=0,B.map(t=>{H.push(t)}),B.length=0})},pointer:K,track:function(t){[].concat(t).map(t=>{t._r||(t._r=t.render,t.render=function(){B.push(this),this._r()},$.push(t))})},untrack:function(t){[].concat(t).map(t=>{t.render=t._r,t._r=0;let e=$.indexOf(t);-1!==e&&$.splice(e,1)})},pointerOver:function(t){return!!$.includes(t)&&J()===t},onPointerDown:function(t){X.onDown=t},onPointerUp:function(t){X.onUp=t},pointerPressed:function(t){return!!N[t]},Pool:st,Quadtree:rt,Sprite:lt,SpriteSheet:pt,setStoreItem:function(t,e){void 0===e?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(e))},getStoreItem:function(t){let e=localStorage.getItem(t);try{e=JSON.parse(e)}catch(t){}return e},TileEngine:function(t={}){let{width:e,height:i,tilewidth:s,tileheight:n,context:h=c(),tilesets:r,layers:o}=t,l=e*s,d=i*n,u=document.createElement("canvas"),p=u.getContext("2d");u.width=l,u.height=d;let f={},g={},m=Object.assign({context:h,mapwidth:l,mapheight:d,_sx:0,_sy:0,get sx(){return this._sx},get sy(){return this._sy},set sx(t){this._sx=Math.min(Math.max(0,t),l-a().width)},set sy(t){this._sy=Math.min(Math.max(0,t),d-a().height)},render(){v(u)},renderLayer(t){let e=g[t],i=f[t];e||((e=document.createElement("canvas")).width=l,e.height=d,g[t]=e,m._r(i,e.getContext("2d"))),v(e)},layerCollidesWith(t,e){let i=y(e.y),s=w(e.x),n=y(e.y+e.height),h=w(e.x+e.width),r=f[t];for(let t=i;t<=n;t++)for(let e=s;e<=h;e++)if(r.data[e+t*this.width])return!0;return!1},tileAtLayer(t,e){let i=e.row||y(e.y),s=e.col||w(e.x);return f[t]?f[t].data[s+i*m.width]:-1},setTileAtLayer(t,e,i){let s=e.row||y(e.y),n=e.col||w(e.x);f[t]&&(f[t].data[n+s*m.width]=i,x())},_r:function(t,e){e.save(),e.globalAlpha=t.opacity,t.data.map((t,i)=>{if(!t)return;let s;for(let e=m.tilesets.length-1;e>=0&&!(t/(s=m.tilesets[e]).firstgid>=1);e--);let n=s.tilewidth||m.tilewidth,h=s.tileheight||m.tileheight,r=s.margin||0,o=s.image,a=t-s.firstgid,c=s.columns||o.width/(n+r)|0,l=i%m.width*n,d=(i/m.width|0)*h,u=a%c*(n+r),p=(a/c|0)*(h+r);e.drawImage(o,u,p,n,h,l,d,n,h)}),e.restore()},layerCanvases:g},t);function y(t){return(m.sy+t)/m.tileheight|0}function w(t){return(m.sx+t)/m.tilewidth|0}function x(){m.layers&&m.layers.map(t=>{f[t.name]=t,!1!==t.visible&&m._r(t,p)})}function v(t){let{width:e,height:i}=a();m.context.drawImage(t,m.sx,m.sy,e,i,0,0,e,i)}return m.tilesets.map(e=>{let i=(window.__k?window.__k.dm.get(t):"")||window.location.href;if(e.source){if(!window.__k)throw Error('You must use "load" or "loadData" to resolve tileset.source');let t=window.__k.d[window.__k.u(e.source,i)];if(!t)throw Error(`You must load the tileset source "${e.source}" before loading the tileset`);Object.keys(t).map(i=>{e[i]=t[i]})}if(""+e.image===e.image){if(!window.__k)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let t=window.__k.i[window.__k.u(e.image,i)];if(!t)throw Error(`You must load the image "${e.image}" before loading the tileset`);e.image=t}}),x(),m},Vector:at};const gt={weaponSpeed:0,power:1,charSpeed:2};class mt{constructor(t,e,i){this.name=t,this.icon=e,this.effect=i}getSprites(){if(!this.sprites){const t=pt({image:document.querySelector("#stats"),frameWidth:30,frameHeight:30,animations:{walk:{frames:`${gt[this.icon]}..${gt[this.icon]}`,frameRate:1e3}}});this.sprites=[lt({type:"skill",x:10,y:0,height:24,width:24,animations:t.animations})]}return this.sprites}}const yt=[function(){return new mt("Speed Increase","weaponSpeed",t=>{t.swordSpeedBuff+=.02})},function(){return new mt("Power Increase","power",t=>{t.powerBuff+=10})},function(){return new mt("Speed Increase","charSpeed",t=>{t.charSpeedBuff+=5})}];const wt=t=>{const e=t.game.getClosest(t.playerSprite,"monster");e.distance&&(t.setTarget(e.sprite),t.hit())};class xt{constructor(t){this.player=t,this.syncPosition(t.getPlayerSprite())}syncPosition({x:t,y:e}){const i=this.getSprites();this.animate||(i.x=t+15,i.y=e+35)}getSprites(){if(!this.sprite){const t=this,e=this.player;this.sprite=ft.Sprite({type:"weapon",x:40,y:50,dx:0,height:38,width:16,image:document.querySelector("#sword"),anchor:{x:0,y:1},rotation:0,rotationDelta:e.swordSpeed});const i=this.sprite.update.bind(this.sprite);this.sprite.update=function(){i(),t.animate&&(this.rotation=this.rotation+e.swordSpeed)}.bind(this.sprite)}return this.sprite}throw(t){const e=t.x+this.sprite.width/2-(this.sprite.x+this.sprite.width/2),i=t.y+this.sprite.height/2-(this.sprite.y+this.sprite.height/2),s=Math.sqrt(e*e+i*i),n=e/s*5,h=i/s*5;this.sprite.dx=n,this.sprite.dy=h,this.animate=!0,this.sprite.ttl=75}}function vt(t,{x:e=0,color:i="rgba(0, 0, 0, 0.5)"}={}){const s=t.render.bind(t);t.shadowColor=i,t.render=function(){this.context.save(),this.context.beginPath(),this.context.shadowColor=this.context.fillStyle=t.shadowColor,this.context.ellipse(this.x+this.width/2+e,this.y+this.height,this.width/2,5,0,0,2*Math.PI),this.context.shadowBlur=10,this.context.fill(),this.context.restore(),s()}.bind(t)}function _t(t,e,i){const s=e.render.bind(e),n={x:0,y:0,...i};e.render=function(){if(t.health<100){const i=e.x+n.x,s=e.y+n.y,h=e.width,r=5;this.context.save(),this.context.beginPath(),this.context.strokeStyle="rgba(0,0,0,1)",this.context.fillStyle="rgba(100,100,100,0.7)",this.context.rect(i,s,h,r),this.context.fill(),this.context.stroke(),this.context.closePath(),this.context.beginPath(),this.context.fillStyle=function(t){return t.health>70?"rgba(100, 250, 100, 0.7)":t.health>40?"rgba(255, 255, 100, 0.7)":"rgba(255, 100, 100, 0.7)"}(t),this.context.rect(i,s,h/100*t.health,r),this.context.fill(),this.context.restore()}s()}.bind(e)}class bt{constructor({level:t=10}={}){this.level=t,this.healthPoints=this.baseHealth}get health(){return~~(this.healthPoints/this.baseHealth*100)}get baseHealth(){return 100*this.level}}class kt extends bt{constructor(t,e){super(),this.game=t,this.controller=e,this.y=100,this.size=52,this._power=10,this.powerBuff=0,this._swordSpeed=.3,this.swordSpeedBuff=0,this.charSpeedBuff=0,this.skills=function(t){let e=[];for(let i=0;i<t;i++)e.push(yt[~~(Math.random()*yt.length)]());return e}(5),this.weapons=[new xt(this)],this.target=null,this.skills.forEach(t=>t.effect(this))}get isMoving(){const t=this.getPlayerSprite();return(t.prevX||t.x)!==t.x||(t.prevY||t.y)!==t.y}get swordSpeed(){return this._swordSpeed+this.swordSpeedBuff}get power(){return this._power+this.powerBuff}getSprites(){const t=this.skills.reduce((t,e,i)=>{const s=e.getSprites()[0];return s.x=(i+1)*(s.width+10)-30,t.concat(s)},[]),e=this.weapons.flatMap(t=>t.getSprites());return t.concat(this.getPlayerSprite()).concat(e)}hit(){this.primaryWeapon&&this.target&&(this.primaryWeapon.throw({x:this.target.x,y:this.target.y}),setTimeout(()=>{this.weapons.push(new xt(this))},500))}resetTarget(){this.target&&(this.target.targeted=!1),this.target=null}setTarget(t){this.target=this.target||t,this.target.targeted=!0}getPlayerSprite(){if(!this.playerSprite){const t=document.querySelector("#chars"),e=ft.SpriteSheet({image:t,frameWidth:16,frameHeight:26,animations:{walk:{frames:"0..3",frameRate:8}}});this.playerSprite=ft.Sprite({type:"player",x:10,y:this.y-this.size,height:52,width:32,animations:e.animations}),vt(this.playerSprite),_t(this,this.playerSprite),function(t){const e=t.playerSprite.update;t.playerSprite.update=function(){this.prevX=this.x,this.prevY=this.y,e.call(this);const i=t.controller.getAxis();this.dx=2*i.x,this.dy=2*i.y,t.isMoving?(t.primaryWeapon&&t.primaryWeapon.syncPosition(this),t.resetTarget()):wt(t)}.bind(t.playerSprite)}(this),function(t){const e=ft.getCanvas(),i=t.playerSprite;e.addEventListener("touchstart",e=>{t.resetTarget()}),e.addEventListener("touchmove",t=>{t.preventDefault()}),e.addEventListener("touchend",e=>{i.dx=0,i.dy=0,wt(t)},!1)}(this)}return this.playerSprite}get primaryWeapon(){return this.weapons.find(t=>!t.animate)}}class St extends bt{constructor({level:t=10}={}){super({level:t})}getSprites(){return[this.getMonsterSprite()]}getMonsterSprite(){if(!this.sprite){const t=document.querySelector("#chars"),e=ft.SpriteSheet({image:t,frameWidth:16,frameHeight:26,animations:{walk:{frames:"9..12",frameRate:8}}});this.sprite=ft.Sprite({entity:this,type:"monster",x:100,y:100,dx:3*Math.random()-2,dy:3*Math.random()-2,height:52,width:32,animations:e.animations,update(){this.advance(),this.targeted?this.shadowColor="rgba(250, 100, 100, 0.7)":this.shadowColor="rgba(0, 0, 0, 0.5)",(this.x<10||this.x>canvas.width-32)&&(this.dx*=-1),(this.y<16||this.y>canvas.height-82)&&(this.dy*=-1)}}),vt(this.sprite,{x:-5}),_t(this,this.sprite,{x:-5,y:10})}return this.sprite}}class Mt{constructor(){this.layers={}}add(t,e=10){this.layers[e]=(this.layers[e]||[]).concat(t)}remove(t,e=10){this.layers[e]=(this.layers[e]||[]).filter(e=>e!=t)}getSprites(t=(()=>!0)){return Object.keys(this.layers).sort().filter(t).flatMap(t=>{return this.layers[t].flatMap(t=>t.getSprites())}).flat().filter(t=>t.isAlive())}getClosest(t,e){const i=this.getSprites(t=>"tile"!==t.type).filter(i=>i!==t&&i.type===e),s=(t,e)=>Math.sqrt(Math.pow(Math.abs(t.x-e.x),2)+Math.pow(Math.abs(t.y-e.y),2)),n=i.sort((e,i)=>s(t,e)-s(t,i));return{distance:s(t,n[0]),sprite:n[0]}}findCurrentPlatform(t){return this.entities.find(e=>"platform"===e.type&&e.x<=t&&e.x+e.width>=t)}}const At=16,Et=32;class Pt{constructor(t,e){this.height=~~(e/Et),this.width=~~(t/Et)-1,this.tiles=this.generate()}getSprites(){if(!this.sprites){const t=document.querySelector("#level");this.sprites=this.tiles.map(e=>{const i=pt({image:t,frameWidth:At,frameHeight:At,animations:{ground:{frames:`${e.frame}..${e.frame}`,frameRate:1e3}}});return lt({type:"tile",x:e.x*Et,y:e.y*Et,height:Et,width:Et,animations:i.animations})})}return this.sprites}generate(){let t=[];for(let e=0;e<=this.height;e++)for(let i=0;i<=this.width;i++){const s=Math.random()<.2?~~(3*Math.random()):0,n=Math.random()<.1?15+~~Math.random():4;0===e?0===i?t.push({x:i,y:e,frame:12}):i===this.width?t.push({x:i,y:e,frame:14}):t.push({x:i,y:e,frame:13}):1===e?0===i?t.push({x:i,y:e,frame:8}):i===this.width?t.push({x:i,y:e,frame:9}):t.push({x:i,y:e,frame:n}):e===this.height-1?(t.push({x:i,y:e,frame:s}),0===i?t.push({x:i,y:e,frame:6}):i===this.width?t.push({x:i,y:e,frame:7}):(t.push({x:i,y:e,frame:s}),t.push({x:i,y:e,frame:13}))):e===this.height?0===i?t.push({x:i,y:e,frame:3}):i===this.width?t.push({x:i,y:e,frame:5}):t.push({x:i,y:e,frame:n}):(t.push({x:i,y:e,frame:s}),0===i?t.push({x:i,y:e,frame:10}):i===this.width&&t.push({x:i,y:e,frame:11}))}return t}}var jt=i(1),Tt=i.n(jt);class zt{constructor(t,e){this.assets=t,this.loaded=[],this.callback=e,this.load()}load(){const t=t=>{this.loaded.push(t),this.verify()};this.assets.forEach((e,i)=>{setTimeout(()=>{e.complete?t(e):e.onload=()=>{t(e)}},100*i)})}verify(){this.loaded.length===this.assets.length&&setTimeout(()=>{this.callback()},1e3)}getSprites(){const t=ft.getCanvas(),e=~~(.8*t.width),i=()=>e*(this.loaded.length/this.assets.length)-4;return this.sprites||(this.sprites=[ft.Sprite({x:(t.width-e)/2,y:t.height/2-10,color:"white",width:e,height:20}),ft.Sprite({x:(t.width-e)/2+2,y:t.height/2-10+2,color:"grey",width:i(),height:16,update(){this.advance(),this.width=i()}})]),this.sprites}}(()=>{const{width:t,height:e}=function(){const t=document.querySelector("#canvas"),e={width:window.innerWidth,height:window.innerHeight};return t.width=e.width,t.height=e.height,e}(),i=new Mt,s=new Tt.a({container:document.querySelector("#controller"),"button-size":40,"track-size":80,"track-color":"#72d6ce99","track-stroke-color":"#222222"});let n;const h=new zt(document.querySelectorAll("img"),()=>{n=new kt(i,s),i.remove(h),i.add(new Pt(t,e),0),i.add(n),i.add(new St),i.add(new St),i.add(new St)});ft.init(),ft.initKeys(),i.add(h),ft.GameLoop({update(){const t=i.getSprites(t=>"0"!==t),e=t.filter(t=>"monster"===t.type);t.forEach(t=>{"weapon"===t.type&&e.forEach(e=>{const i=e.x-t.x,s=e.y-t.y;Math.sqrt(i*i+s*s)<e.width+t.width-20&&(e.entity.healthPoints-=100,e.entity.healthPoints<=0&&(e.ttl=0,n.resetTarget()),t.ttl=0)}),t.update()})},render(){i.getSprites().forEach(t=>t.render()),s.draw()}}).start()})();i(2)}]);</script></body></html>